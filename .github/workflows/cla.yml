name: Verify Contributor License Agreement

on: [pull_request]

jobs:
  cla-validate:

    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Check CLA signing status for ${{ github.event.pull_request.user.login }}
      run: |
        cat > unsigned-cla.txt <<EOF
          Hello ${{ github.event.pull_request.user.login }},

          Thank you for your contribution to cloud-init.

          In order for us to merge this pull request, you need
          to have signed the Contributor License Agreement (CLA).
          Please sign the CLA by following our
          hacking guide at:
            https://cloudinit.readthedocs.io/en/latest/topics/hacking.html

          Thanks,
          Your friendly cloud-init upstream
        EOF
        grep -q ': \"${{ github.event.pull_request.user.login }}\"' ./tools/.lp-to-git-user && \
           echo "Thanks ${{ github.event.pull_request.user.login }} for signing cloud-init's CLA" || \
           (cat unsigned-cla.txt && exit 1)
