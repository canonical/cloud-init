cc_users_groups:
  description: "This module configures users and groups. For more detailed information\
    \ on\nuser options, see the :ref:`Including users and groups <yaml_examples>`\n\
    config example.\n\nGroups to add to the system can be specified under the ``groups``\
    \ key as a\nstring of comma-separated groups to create, or a list. Each item in\
    \ the\nlist should either contain a string of a single group to create, or a\n\
    dictionary with the group name as the key and string of a single user as a\nmember\
    \ of that group or a list of users who should be members of the group.\n\n.. note::\n\
    \   Groups are added before users, so any users in a group list must\n   already\
    \ exist on the system.\n\nUsers to add can be specified as a string or list under\
    \ the ``users`` key.\nEach entry in the list should either be a string or a dictionary.\
    \ If a\nstring is specified, that string can be comma-separated usernames to\n\
    create, or the reserved string ``default`` which represents the primary\nadmin\
    \ user used to access the system. The ``default`` user varies per\ndistribution\
    \ and is generally configured in ``/etc/cloud/cloud.cfg`` by the\n``default_user\
    \ key``.\n\nEach ``users`` dictionary item must contain either a ``name`` or\n\
    ``snapuser`` key, otherwise it will be ignored. Omission of ``default``\nas the\
    \ first item in the ``users`` list skips creation the default user.\nIf no ``users``\
    \ key is provided, the default behavior is to create the\ndefault user via this\
    \ config:::\n\n    users:\n    - default\n\n.. note::\n   Specifying a hash of\
    \ a user's password with ``passwd`` is a security\n   risk if the cloud-config\
    \ can be intercepted. SSH authentication is\n   preferred.\n\n.. note::\n   If\
    \ specifying a ``doas`` rule for a user, ensure that the syntax for\n   the rule\
    \ is valid, as the only checking performed by cloud-init is to\n   ensure that\
    \ the user referenced in the rule is the correct user.\n\n.. note::\n   If specifying\
    \ a ``sudo`` rule for a user, ensure that the syntax for\n   the rule is valid,\
    \ as it is not checked by cloud-init.\n\n.. note::\n   Most of these configuration\
    \ options will not be honored if the user\n   already exists. The following options\
    \ are the exceptions, and are\n   applied to already-existing users; ``plain_text_passwd``,\
    \ ``doas``,\n   ``hashed_passwd``, ``lock_passwd``, ``sudo``, ``ssh_authorized_keys``,\n\
    \   ``ssh_redirect_user``.\n\nThe ``user`` key can be used to override the ``default_user``\
    \ configuration\ndefined in ``/etc/cloud/cloud.cfg``. The ``user`` value should\
    \ be a\ndictionary which supports the same config keys as the ``users`` dictionary\n\
    items.\n"
  examples:
  - comment: 'Add the ``default_user`` from ``/etc/cloud/cloud.cfg``. This is also
      the

      default behavior of cloud-init when no ``users`` key is provided.

      '
    file: cc_users_groups/example1.yaml
  - comment: 'Add the ``admingroup`` with members ``root`` and ``sys``, and an empty

      group ``cloud-users``.

      '
    file: cc_users_groups/example2.yaml
  - comment: 'Skip creation of the ``default`` user and only create ``newsuper``.

      Password-based login is rejected, but the GitHub user ``TheRealFalcon``

      and the Launchpad user ``falcojr`` can SSH as ``newsuper``. The default

      shell for ``newsuper`` is bash instead of system default.

      '
    file: cc_users_groups/example3.yaml
  - comment: 'Skip creation of the ``default`` user and only create ``newsuper``.

      Password-based login is rejected, but the GitHub user ``TheRealFalcon``

      and the Launchpad user ``falcojr`` can SSH as ``newsuper``.

      ``doas``/``opendoas`` is configured to permit this user to run commands

      as other users (without being prompted for a password) except not as

      root.

      '
    file: cc_users_groups/example4.yaml
  - comment: 'On a system with SELinux enabled, add ``youruser`` and set the

      SELinux user to ``staff_u``. When omitted on SELinux, the system will

      select the configured default SELinux user.

      '
    file: cc_users_groups/example5.yaml
  - comment: 'To redirect a legacy username to the ``default`` user for a

      distribution, ``ssh_redirect_user`` will accept an SSH connection and

      emit a message telling the client to SSH as the ``default`` user.

      SSH clients will get the message;

      '
    file: cc_users_groups/example6.yaml
  - comment: 'Override any ``default_user`` config in ``/etc/cloud/cloud.cfg`` with

      supplemental config options.

      This config will make the default user ``mynewdefault`` and change

      the user to not have ``sudo`` rights.

      '
    file: cc_users_groups/example7.yaml
  - comment: Avoid creating any ``default_user``.
    file: cc_users_groups/example8.yaml
  name: Users and Groups
  title: Configure users and groups
